---
title: "Exploring the Relationship Between Seafood Consumption and Life Expectancy"
author: "Amaya McMillin, Ashley Fong, Constantine Golematis, Rayne Lejano"
format: html
editor: visual
embed-resources: true
code-tools: true
code-fold: true
---

# 1 Project Proposal & Data

**Data:**

```{r, include = FALSE}
library(tidyverse)
library(gganimate)
library(glue)
library(gifski)

seafood <- read_csv("fisfod_cons_pc.csv")
lex <- read_csv("lex.csv")
```

### Exploring the Relationship Between Seafood Consumption and Life Expectancy

#### Data Sources

This analysis examines two datasets from Gapminder: life expectancy at birth and fish and seafood consumption per capita. Gapminder, an independent foundation, compiles data from multiple sources, filling gaps to create comprehensive historical datasets. Notably, the country variable in both datasets reflects current geopolitical boundaries.

#### Life Expectancy Dataset

This dataset provides the expected lifespan of a newborn based on birth year and country. It spans from 1800 to 2100, covering 196 countries.

#### Fish and Seafood Consumption Dataset

This dataset records the average annual per capita availability of fish and seafood (in kilograms), accounting for imports and domestic production while excluding exports, animal feed, and distribution losses. While this measure reflects overall supply rather than direct consumption, it offers a useful proxy. The dataset spans from 1961 to 2018 and includes 170 countries.

#### Hypothesis

We hypothesize that higher seafood consumption is positively correlated with life expectancy. Seafood is associated with numerous health benefits, including improved cognitive function and cardiovascular health. By analyzing these datasets, we aim to determine whether increased seafood consumption aligns with longer lifespans across countries.

## 1.1 Data Cleaning

Many values in both datasets are recorded as N/A, which could hinder our ability to conduct a thorough analysis. To address this issue and maintain data integrity, we have chosen to replace these missing values with the average of their respective rows. This approach ensures that each data point remains as representative as possible while minimizing potential biases introduced by missing values. By using row averages, we preserve the overall structure of the data while allowing for meaningful comparisons across observations.

```{r}
lex[-1] <- lex[-1] |>
  mutate(across(everything(), ~ ifelse(is.na(.), mean(., na.rm = TRUE), .)))

seafood[-1] <- seafood[-1] |>
  mutate(across(everything(), ~ ifelse(is.na(.), mean(., na.rm = TRUE), .)))
```

## 1.2 Pivoting Longer

To successfully merge the two datasets, we must first convert them from a wide format to a long format. In their current structure, each dataset contains a single column for the country, while the remaining columns correspond to different years. If we were to attempt a direct join in this wide format, we would end up with multiple columns for each year---one from each dataset---making it challenging to distinguish which values belong to which dataset.

By pivoting the datasets to a long format, we restructure the data so that instead of having separate columns for each year, we create two columns: one for the year and another for the corresponding value (either life expectancy or seafood consumption). This transformation standardizes the structure of both datasets, allowing for a clean and efficient merge based on country and year. As a result, each row will uniquely represent a specific country-year combination, with separate columns indicating life expectancy and seafood consumption, facilitating a clearer and more interpretable analysis.

```{r}
life_expectancy_long <- lex |>
  pivot_longer(cols = -country,
               names_to = 'year',
               values_to = 'life_expectancy') |>
  mutate(year = as.factor(year))

seafood_long <- seafood |>
  pivot_longer(cols = -country, 
               names_to = 'year',
               values_to = 'kg_seafood') |>
  mutate(year = as.factor(year))
```

## 1.3 Joining Data

Now that we have transformed both datasets into a long format, we can proceed with merging them to perform our analysis. To ensure consistency, we will use an inner join, which retains only the observations that appear in both datasets.

The life expectancy dataset spans from 1800 to 2100, while the seafood consumption dataset covers the years 1961 to 2018. Since these datasets have different time ranges, an inner join ensures that we only analyze data for years that are present in both datasets---specifically, the period from 1961 to 2018. This approach prevents us from introducing missing values into our analysis and ensures that every observation contains both life expectancy and seafood consumption data.

By merging the datasets in this manner, we create a refined dataset where each row represents a unique country-year combination, with corresponding values for both variables. This standardized structure allows us to effectively explore the relationship between seafood consumption and life expectancy across different countries and time periods.

```{r}
full_data <- life_expectancy_long |>
  inner_join(seafood_long, by = c('country', 'year'))
```

# 2 Linear Regression

## 2.1 Data Visualization

```{r}
full_data |>
  ggplot(aes(x = kg_seafood,
             y = life_expectancy)) +
  geom_point() + 
  labs(x = "Seafood Consumption (kg)",
       y = NULL,
       subtitle = "Life Expectancy (years)",
       title = "Relationship between seafood consumption and life expectancy")
```

```{r}
# RUNNING THIS CHUNK WILL MAKE A LOT OF IMAGES

full_data <- full_data |>
  mutate(year_numeric = as.integer(as.character(year)))

full_data |>
  ggplot(aes(x = kg_seafood,
             y = life_expectancy)) +
  geom_point() + 
  labs(x = "Seafood Consumption (kg)",
       y = "Life Expectancy (years)",
       subtitle = 'Year: {frame_time}',
       title = "Relationship between seafood consumption and life expectancy") +
  transition_time(year_numeric) +
  ease_aes('linear')
```

## 2.2 Linear Regression

## 2.3 Model Fit
